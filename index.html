<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç½‘ç›˜èµ„æ–™æœç´¢ç³»ç»Ÿ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            }
        }
    </script>
    <style>
        .file-icon {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            flex-shrink: 0;
        }
        
        .search-result-item:hover {
            transform: translateY(-1px);
            transition: transform 0.2s ease-in-out;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading-spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #5D5CDE;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 min-h-screen transition-colors duration-300">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-gray-900 dark:text-white">ç½‘ç›˜èµ„æ–™æœç´¢ç³»ç»Ÿ</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="adminBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-purple-600 transition-colors text-base">
                        ç®¡ç†åå°
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- ä¸»ç•Œé¢ -->
    <div id="mainView" class="max-w-4xl mx-auto px-4 py-8">
        <!-- æœç´¢åŒºåŸŸ -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8">
            <div class="text-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">æœç´¢æ‚¨çš„æ–‡ä»¶</h2>
                <p class="text-gray-600 dark:text-gray-400">è¾“å…¥å…³é”®è¯å¿«é€Ÿå®šä½æ–‡ä»¶åœ¨ç½‘ç›˜ä¸­çš„ä½ç½®</p>
            </div>
            
            <div class="relative max-w-2xl mx-auto">
                <input type="text" id="searchInput" placeholder="è¾“å…¥æ–‡ä»¶åå…³é”®è¯..." class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                <div id="loadingIndicator" class="absolute right-3 top-1/2 transform -translate-y-1/2 hidden">
                    <div class="loading-spinner"></div>
                </div>
            </div>
            
            <div class="mt-4 text-center">
                <p class="text-sm text-gray-500 dark:text-gray-400">
                    å·²ç´¢å¼• <span id="fileCount" class="font-semibold text-primary">0</span> ä¸ªæ–‡ä»¶
                </p>
            </div>
        </div>

        <!-- æœç´¢ç»“æœ -->
        <div id="searchResults" class="hidden">
            <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                    æœç´¢ç»“æœ (<span id="resultCount">0</span>)
                </h3>
                <div id="resultsList" class="space-y-3"></div>
            </div>
        </div>

        <!-- ç©ºçŠ¶æ€æç¤º -->
        <div id="emptyState" class="text-center py-12">
            <div class="text-gray-400 dark:text-gray-500 mb-4">
                <svg class="mx-auto h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">å¼€å§‹æœç´¢æ–‡ä»¶</h3>
            <p class="text-gray-500 dark:text-gray-400">åœ¨ä¸Šæ–¹æœç´¢æ¡†ä¸­è¾“å…¥å…³é”®è¯æ¥æŸ¥æ‰¾æ–‡ä»¶</p>
        </div>

        <!-- æ— ç»“æœçŠ¶æ€ -->
        <div id="noResults" class="hidden text-center py-12">
            <div class="text-gray-400 dark:text-gray-500 mb-4">
                <svg class="mx-auto h-16 w-16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">æœªæ‰¾åˆ°ç›¸å…³æ–‡ä»¶</h3>
            <p class="text-gray-500 dark:text-gray-400">è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–æ£€æŸ¥æ‹¼å†™</p>
        </div>
    </div>

    <!-- ç®¡ç†åå° -->
    <div id="adminView" class="hidden max-w-4xl mx-auto px-4 py-8">
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-gray-900 dark:text-white">ç®¡ç†åå°</h2>
                <button id="backBtn" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600 transition-colors text-base">
                    è¿”å›æœç´¢
                </button>
            </div>
            
            <!-- è·¯å¾„æ˜ å°„è®¾ç½® -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">è·¯å¾„æ˜ å°„è®¾ç½®</h3>
                
                <!-- ç½‘ç›˜æ ¹è·¯å¾„ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">ç½‘ç›˜æ ¹è·¯å¾„</label>
                    <div class="flex space-x-3">
                        <input type="text" id="netdiskRootPath" placeholder="è¾“å…¥ç½‘ç›˜æ ¹è·¯å¾„ï¼Œå¦‚ï¼šA/" class="flex-1 px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                    </div>
                </div>
                
                <!-- æœ¬åœ°è·¯å¾„å‰ç¼€ -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">æœ¬åœ°è·¯å¾„å‰ç¼€ï¼ˆéœ€è¦æ›¿æ¢çš„éƒ¨åˆ†ï¼‰</label>
                    <div class="flex space-x-3">
                        <input type="text" id="localPathPrefix" placeholder="å¦‚ï¼šBaiduNetdiskDownload\" class="flex-1 px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                    </div>
                </div>
                
                <div class="flex space-x-3 mb-4">
                    <button id="savePathMapping" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors text-base">
                        ä¿å­˜è·¯å¾„æ˜ å°„
                    </button>
                    <button id="testPathMapping" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors text-base">
                        æµ‹è¯•è½¬æ¢
                    </button>
                </div>
                
                <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-2">
                        <strong>å½“å‰æ˜ å°„è®¾ç½®ï¼š</strong>
                    </p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        ç½‘ç›˜æ ¹è·¯å¾„ï¼š<span id="currentNetdiskPath" class="font-semibold">æœªè®¾ç½®</span>
                    </p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">
                        æœ¬åœ°è·¯å¾„å‰ç¼€ï¼š<span id="currentLocalPrefix" class="font-semibold">æœªè®¾ç½®</span>
                    </p>
                    <div id="pathMappingExample" class="mt-2 text-xs text-gray-500 dark:text-gray-400"></div>
                </div>
            </div>
            
            <!-- æ–‡ä»¶ç´¢å¼•ç®¡ç† -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">æ–‡ä»¶ç´¢å¼•ç®¡ç†</h3>
                
                <!-- è·¯å¾„æ ¼å¼é€‰æ‹© -->
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        é€‰æ‹©å¯¼å…¥æ ¼å¼
                    </label>
                    <div class="flex space-x-4 mb-3">
                        <label class="flex items-center">
                            <input type="radio" name="importFormat" value="windows" class="mr-2" checked="">
                            <span class="text-sm text-gray-700 dark:text-gray-300">Windowsè·¯å¾„æ ¼å¼</span>
                        </label>
                        <label class="flex items-center">
                            <input type="radio" name="importFormat" value="json" class="mr-2">
                            <span class="text-sm text-gray-700 dark:text-gray-300">JSONæ ¼å¼</span>
                        </label>
                    </div>
                </div>
                
                <!-- Windowsè·¯å¾„æ‰¹é‡å¯¼å…¥ -->
                <div id="windowsPathImport" class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        æ‰¹é‡å¯¼å…¥Windowsæ–‡ä»¶è·¯å¾„ï¼ˆæ¯è¡Œä¸€ä¸ªè·¯å¾„ï¼‰
                    </label>
                    <textarea id="windowsPathInput" rows="8" placeholder="BaiduNetdiskDownload\6æœˆä»½7å·åˆ°10å·\25.06.10æ›´æ–°\ä½ç¢³ç‰ˆæ‘è§„æ°‘çº¦.docx
BaiduNetdiskDownload\6æœˆä»½7å·åˆ°10å·\25.06.10æ›´æ–°\å·¥ä½œæŠ¥å‘Š.xlsx
BaiduNetdiskDownload\é¡¹ç›®æ–‡æ¡£\ä¼šè®®è®°å½•.pdf" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"></textarea>
                    <div class="flex justify-between items-center mt-3">
                        <div class="flex space-x-3">
                            <button id="importWindowsPaths" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors text-base">
                                å¯¼å…¥Windowsè·¯å¾„
                            </button>
                            <button id="convertPaths" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors text-base">
                                é¢„è§ˆè½¬æ¢ç»“æœ
                            </button>
                        </div>
                        <button id="clearAll" class="bg-red-600 text-white px-6 py-2 rounded-lg hover:bg-red-700 transition-colors text-base">
                            æ¸…ç©ºæ‰€æœ‰æ•°æ®
                        </button>
                    </div>
                </div>
                
                <!-- JSONæ ¼å¼æ‰¹é‡å¯¼å…¥ -->
                <div id="jsonPathImport" class="mb-6 hidden">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                        æ‰¹é‡å¯¼å…¥æ–‡ä»¶è·¯å¾„ (JSONæ ¼å¼)
                    </label>
                    <textarea id="bulkImport" rows="8" placeholder="[{&quot;name&quot;: &quot;æ–‡æ¡£1.docx&quot;, &quot;path&quot;: &quot;B/C/D/æ–‡æ¡£1.docx&quot;, &quot;type&quot;: &quot;docx&quot;}, {&quot;name&quot;: &quot;è¡¨æ ¼1.xlsx&quot;, &quot;path&quot;: &quot;B/C/E/è¡¨æ ¼1.xlsx&quot;, &quot;type&quot;: &quot;xlsx&quot;}]" class="w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"></textarea>
                    <div class="flex justify-between items-center mt-3">
                        <button id="importFiles" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors text-base">
                            å¯¼å…¥JSONæ–‡ä»¶
                        </button>
                    </div>
                </div>
                
                <!-- è½¬æ¢é¢„è§ˆ -->
                <div id="conversionPreview" class="hidden mb-6">
                    <h4 class="text-md font-medium text-gray-900 dark:text-white mb-3">è·¯å¾„è½¬æ¢é¢„è§ˆ</h4>
                    <div id="previewContent" class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg max-h-64 overflow-y-auto text-sm"></div>
                    <div class="flex space-x-3 mt-3">
                        <button id="confirmConversion" class="bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors text-base">
                            ç¡®è®¤å¯¼å…¥
                        </button>
                        <button id="cancelConversion" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors text-base">
                            å–æ¶ˆ
                        </button>
                    </div>
                </div>
                
                <!-- å•ä¸ªæ–‡ä»¶æ·»åŠ  -->
                <div class="border-t border-gray-200 dark:border-gray-600 pt-6">
                    <h4 class="text-md font-medium text-gray-900 dark:text-white mb-3">æ·»åŠ å•ä¸ªæ–‡ä»¶</h4>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
                        <input type="text" id="fileName" placeholder="æ–‡ä»¶å" class="px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                        <input type="text" id="filePath" placeholder="ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ï¼šB/C/D/æ–‡ä»¶å.docxï¼‰" class="px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400">
                        <select id="fileType" class="px-4 py-2 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                            <option value="docx">Word (.docx)</option>
                            <option value="pdf">PDF (.pdf)</option>
                            <option value="pptx">PowerPoint (.pptx)</option>
                            <option value="xlsx">Excel (.xlsx)</option>
                            <option value="txt">æ–‡æœ¬ (.txt)</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                    <button id="addFile" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-purple-600 transition-colors text-base">
                        æ·»åŠ æ–‡ä»¶
                    </button>
                </div>
            </div>
            
            <!-- å½“å‰æ–‡ä»¶åˆ—è¡¨ -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                    å½“å‰æ–‡ä»¶åˆ—è¡¨ (<span id="adminFileCount">0</span>)
                </h3>
                <div id="fileList" class="max-h-96 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-lg"></div>
            </div>
        </div>
    </div>

    <!-- Toast é€šçŸ¥ -->
    <div id="toast" class="fixed bottom-4 right-4 hidden bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50">
        <span id="toastMessage"></span>
    </div>

    <script>
        // æ·±è‰²æ¨¡å¼æ£€æµ‹å’Œè®¾ç½®
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // åº”ç”¨çŠ¶æ€ç®¡ç†
        class FileSearchApp {
            constructor() {
                this.files = [];
                this.rootPath = '';
                this.loadData();
                this.initEventListeners();
                this.updateUI();
            }

            // åŠ è½½æœ¬åœ°å­˜å‚¨çš„æ•°æ®
            loadData() {
                const savedFiles = localStorage.getItem('fileSearchFiles');
                const savedRootPath = localStorage.getItem('fileSearchRootPath');
                const savedLocalPrefix = localStorage.getItem('fileSearchLocalPrefix');
                
                if (savedFiles) {
                    this.files = JSON.parse(savedFiles);
                }
                if (savedRootPath) {
                    this.rootPath = savedRootPath;
                }
                if (savedLocalPrefix) {
                    this.localPathPrefix = savedLocalPrefix;
                }
            }

            // ä¿å­˜æ•°æ®åˆ°æœ¬åœ°å­˜å‚¨
            saveData() {
                localStorage.setItem('fileSearchFiles', JSON.stringify(this.files));
                localStorage.setItem('fileSearchRootPath', this.rootPath);
            }

            // åˆå§‹åŒ–äº‹ä»¶ç›‘å¬
            initEventListeners() {
                // æœç´¢åŠŸèƒ½
                const searchInput = document.getElementById('searchInput');
                let searchTimeout;
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(searchTimeout);
                    searchTimeout = setTimeout(() => {
                        this.performSearch(e.target.value);
                    }, 300);
                });

                // ç®¡ç†åå°åˆ‡æ¢
                document.getElementById('adminBtn').addEventListener('click', () => {
                    this.showAdminView();
                });
                document.getElementById('backBtn').addEventListener('click', () => {
                    this.showMainView();
                });

                // è·¯å¾„æ˜ å°„ç®¡ç†
                document.getElementById('savePathMapping').addEventListener('click', () => {
                    this.savePathMapping();
                });
                document.getElementById('testPathMapping').addEventListener('click', () => {
                    this.testPathMapping();
                });

                // å¯¼å…¥æ ¼å¼åˆ‡æ¢
                document.querySelectorAll('input[name="importFormat"]').forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        this.toggleImportFormat(e.target.value);
                    });
                });

                // Windowsè·¯å¾„å¯¼å…¥
                document.getElementById('importWindowsPaths').addEventListener('click', () => {
                    this.importWindowsPaths();
                });
                document.getElementById('convertPaths').addEventListener('click', () => {
                    this.previewPathConversion();
                });
                document.getElementById('confirmConversion').addEventListener('click', () => {
                    this.confirmPathConversion();
                });
                document.getElementById('cancelConversion').addEventListener('click', () => {
                    this.cancelPathConversion();
                });

                // JSONæ–‡ä»¶ç®¡ç†
                document.getElementById('importFiles').addEventListener('click', () => {
                    this.importFiles();
                });
                document.getElementById('addFile').addEventListener('click', () => {
                    this.addSingleFile();
                });
                document.getElementById('clearAll').addEventListener('click', () => {
                    this.clearAllData();
                });
            }

            // æ‰§è¡Œæœç´¢
            performSearch(query) {
                const loadingIndicator = document.getElementById('loadingIndicator');
                const searchResults = document.getElementById('searchResults');
                const emptyState = document.getElementById('emptyState');
                const noResults = document.getElementById('noResults');

                if (!query.trim()) {
                    searchResults.classList.add('hidden');
                    emptyState.classList.remove('hidden');
                    noResults.classList.add('hidden');
                    return;
                }

                loadingIndicator.classList.remove('hidden');
                
                setTimeout(() => {
                    const results = this.searchFiles(query);
                    this.displaySearchResults(results);
                    loadingIndicator.classList.add('hidden');
                    
                    if (results.length > 0) {
                        searchResults.classList.remove('hidden');
                        emptyState.classList.add('hidden');
                        noResults.classList.add('hidden');
                    } else {
                        searchResults.classList.add('hidden');
                        emptyState.classList.add('hidden');
                        noResults.classList.remove('hidden');
                    }
                }, 200);
            }

            // æœç´¢æ–‡ä»¶
            searchFiles(query) {
                const queryLower = query.toLowerCase();
                return this.files.filter(file => 
                    file.name.toLowerCase().includes(queryLower) ||
                    file.path.toLowerCase().includes(queryLower)
                );
            }

            // æ˜¾ç¤ºæœç´¢ç»“æœ
            displaySearchResults(results) {
                const resultsList = document.getElementById('resultsList');
                const resultCount = document.getElementById('resultCount');
                
                resultCount.textContent = results.length;
                resultsList.innerHTML = '';

                results.forEach(file => {
                    const resultItem = this.createResultItem(file);
                    resultsList.appendChild(resultItem);
                });
            }

            // åˆ›å»ºæœç´¢ç»“æœé¡¹
            createResultItem(file) {
                const div = document.createElement('div');
                div.className = 'search-result-item p-4 border border-gray-200 dark:border-gray-600 rounded-lg hover:shadow-md transition-all cursor-pointer fade-in';
                
                const fullPath = this.rootPath + file.path;
                const fileIcon = this.getFileIcon(file.type);
                
                div.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="file-icon">${fileIcon}</div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center space-x-2 mb-1">
                                <h4 class="text-lg font-medium text-gray-900 dark:text-white truncate">${file.name}</h4>
                                <span class="px-2 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded">${file.type.toUpperCase()}</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <p class="text-sm text-gray-600 dark:text-gray-400 truncate flex-1">${fullPath}</p>
                                <button 
                                    onclick="app.copyPath('${fullPath}')" 
                                    class="text-primary hover:text-purple-600 text-sm font-medium transition-colors"
                                    title="å¤åˆ¶è·¯å¾„"
                                >
                                    å¤åˆ¶
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                return div;
            }

            // è·å–æ–‡ä»¶å›¾æ ‡
            getFileIcon(type) {
                const icons = {
                    'docx': 'ğŸ“„',
                    'pdf': 'ğŸ“•',
                    'pptx': 'ğŸ“Š',
                    'xlsx': 'ğŸ“ˆ',
                    'txt': 'ğŸ“',
                    'other': 'ğŸ“'
                };
                return icons[type] || icons['other'];
            }

            // å¤åˆ¶è·¯å¾„åˆ°å‰ªè´´æ¿
            copyPath(path) {
                if (navigator.clipboard) {
                    navigator.clipboard.writeText(path).then(() => {
                        this.showToast('è·¯å¾„å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                    });
                } else {
                    // é™çº§æ–¹æ¡ˆ
                    const textArea = document.createElement('textarea');
                    textArea.value = path;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    this.showToast('è·¯å¾„å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
                }
            }

            // æ˜¾ç¤ºç®¡ç†åå°
            showAdminView() {
                document.getElementById('mainView').classList.add('hidden');
                document.getElementById('adminView').classList.remove('hidden');
                this.updateAdminUI();
            }

            // æ˜¾ç¤ºä¸»ç•Œé¢
            showMainView() {
                document.getElementById('mainView').classList.remove('hidden');
                document.getElementById('adminView').classList.add('hidden');
                this.updateUI();
            }

            // ä¿å­˜è·¯å¾„æ˜ å°„è®¾ç½®
            savePathMapping() {
                const netdiskRootPath = document.getElementById('netdiskRootPath').value.trim();
                const localPathPrefix = document.getElementById('localPathPrefix').value.trim();
                
                if (!netdiskRootPath) {
                    this.showToast('è¯·è¾“å…¥ç½‘ç›˜æ ¹è·¯å¾„', 'error');
                    return;
                }
                
                this.rootPath = netdiskRootPath.endsWith('/') ? netdiskRootPath : netdiskRootPath + '/';
                this.localPathPrefix = localPathPrefix;
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                localStorage.setItem('fileSearchRootPath', this.rootPath);
                localStorage.setItem('fileSearchLocalPrefix', this.localPathPrefix);
                
                this.updateAdminUI();
                this.showToast('è·¯å¾„æ˜ å°„å·²ä¿å­˜');
            }

            // æµ‹è¯•è·¯å¾„æ˜ å°„
            testPathMapping() {
                const testPath = 'BaiduNetdiskDownload\\6æœˆä»½7å·åˆ°10å·\\25.06.10æ›´æ–°\\ä½ç¢³ç‰ˆæ‘è§„æ°‘çº¦.docx';
                const converted = this.convertWindowsPath(testPath);
                
                if (converted) {
                    this.showToast(`æµ‹è¯•è½¬æ¢æˆåŠŸï¼š${this.rootPath}${converted.path}`, 'success');
                } else {
                    this.showToast('è¯·å…ˆè®¾ç½®è·¯å¾„æ˜ å°„', 'error');
                }
            }

            // åˆ‡æ¢å¯¼å…¥æ ¼å¼
            toggleImportFormat(format) {
                const windowsPathImport = document.getElementById('windowsPathImport');
                const jsonPathImport = document.getElementById('jsonPathImport');
                
                if (format === 'windows') {
                    windowsPathImport.classList.remove('hidden');
                    jsonPathImport.classList.add('hidden');
                } else {
                    windowsPathImport.classList.add('hidden');
                    jsonPathImport.classList.remove('hidden');
                }
            }

            // å¯¼å…¥Windowsè·¯å¾„
            importWindowsPaths() {
                const pathText = document.getElementById('windowsPathInput').value.trim();
                
                if (!pathText) {
                    this.showToast('è¯·è¾“å…¥Windowsæ–‡ä»¶è·¯å¾„', 'error');
                    return;
                }

                if (!this.rootPath || !this.localPathPrefix) {
                    this.showToast('è¯·å…ˆè®¾ç½®è·¯å¾„æ˜ å°„', 'error');
                    return;
                }

                try {
                    const convertedFiles = this.parseWindowsPaths(pathText);
                    
                    if (convertedFiles.length === 0) {
                        this.showToast('æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„', 'error');
                        return;
                    }

                    this.files = [...this.files, ...convertedFiles];
                    this.saveData();
                    this.updateAdminUI();
                    this.updateUI();
                    
                    document.getElementById('windowsPathInput').value = '';
                    this.showToast(`æˆåŠŸå¯¼å…¥ ${convertedFiles.length} ä¸ªæ–‡ä»¶`);
                    
                } catch (error) {
                    this.showToast('å¯¼å…¥å¤±è´¥ï¼š' + error.message, 'error');
                }
            }

            // é¢„è§ˆè·¯å¾„è½¬æ¢
            previewPathConversion() {
                const pathText = document.getElementById('windowsPathInput').value.trim();
                
                if (!pathText) {
                    this.showToast('è¯·è¾“å…¥Windowsæ–‡ä»¶è·¯å¾„', 'error');
                    return;
                }

                if (!this.rootPath || !this.localPathPrefix) {
                    this.showToast('è¯·å…ˆè®¾ç½®è·¯å¾„æ˜ å°„', 'error');
                    return;
                }

                try {
                    const convertedFiles = this.parseWindowsPaths(pathText);
                    this.displayConversionPreview(convertedFiles);
                } catch (error) {
                    this.showToast('è½¬æ¢å¤±è´¥ï¼š' + error.message, 'error');
                }
            }

            // æ˜¾ç¤ºè½¬æ¢é¢„è§ˆ
            displayConversionPreview(convertedFiles) {
                const previewDiv = document.getElementById('conversionPreview');
                const previewContent = document.getElementById('previewContent');
                
                if (convertedFiles.length === 0) {
                    this.showToast('æœªæ‰¾åˆ°æœ‰æ•ˆçš„æ–‡ä»¶è·¯å¾„', 'error');
                    return;
                }

                let previewHTML = `<div class="space-y-2">`;
                previewHTML += `<p class="font-semibold text-gray-800 dark:text-gray-200 mb-3">å°†è½¬æ¢ ${convertedFiles.length} ä¸ªæ–‡ä»¶ï¼š</p>`;
                
                convertedFiles.forEach((file, index) => {
                    const fullPath = this.rootPath + file.path;
                    previewHTML += `
                        <div class="p-2 bg-white dark:bg-gray-600 rounded border border-gray-200 dark:border-gray-500">
                            <div class="flex items-center space-x-2 mb-1">
                                <span>${this.getFileIcon(file.type)}</span>
                                <span class="font-medium text-gray-900 dark:text-white">${file.name}</span>
                                <span class="px-1 py-0.5 text-xs bg-gray-100 dark:bg-gray-500 text-gray-600 dark:text-gray-300 rounded">${file.type}</span>
                            </div>
                            <p class="text-xs text-gray-600 dark:text-gray-400">è½¬æ¢ä¸ºï¼š${fullPath}</p>
                        </div>
                    `;
                });
                
                previewHTML += `</div>`;
                previewContent.innerHTML = previewHTML;
                previewDiv.classList.remove('hidden');
                
                // å­˜å‚¨é¢„è§ˆæ•°æ®ä¾›ç¡®è®¤ä½¿ç”¨
                this.pendingConversionFiles = convertedFiles;
            }

            // ç¡®è®¤è·¯å¾„è½¬æ¢
            confirmPathConversion() {
                if (!this.pendingConversionFiles) {
                    this.showToast('æ²¡æœ‰å¾…è½¬æ¢çš„æ–‡ä»¶', 'error');
                    return;
                }

                this.files = [...this.files, ...this.pendingConversionFiles];
                this.saveData();
                this.updateAdminUI();
                this.updateUI();
                
                document.getElementById('windowsPathInput').value = '';
                document.getElementById('conversionPreview').classList.add('hidden');
                
                this.showToast(`æˆåŠŸå¯¼å…¥ ${this.pendingConversionFiles.length} ä¸ªæ–‡ä»¶`);
                this.pendingConversionFiles = null;
            }

            // å–æ¶ˆè·¯å¾„è½¬æ¢
            cancelPathConversion() {
                document.getElementById('conversionPreview').classList.add('hidden');
                this.pendingConversionFiles = null;
            }

            // è§£æWindowsè·¯å¾„æ–‡æœ¬
            parseWindowsPaths(pathText) {
                const lines = pathText.split('\n').filter(line => line.trim());
                const convertedFiles = [];
                
                for (const line of lines) {
                    const trimmedLine = line.trim();
                    if (trimmedLine && trimmedLine.includes('\\')) {
                        const converted = this.convertWindowsPath(trimmedLine);
                        if (converted) {
                            convertedFiles.push(converted);
                        }
                    }
                }
                
                return convertedFiles;
            }

            // è½¬æ¢å•ä¸ªWindowsè·¯å¾„
            convertWindowsPath(windowsPath) {
                if (!this.rootPath || !this.localPathPrefix) {
                    return null;
                }

                try {
                    // ç§»é™¤æœ¬åœ°è·¯å¾„å‰ç¼€
                    let relativePath = windowsPath;
                    if (this.localPathPrefix && windowsPath.startsWith(this.localPathPrefix)) {
                        relativePath = windowsPath.substring(this.localPathPrefix.length);
                    }
                    
                    // å°†åæ–œæ è½¬æ¢ä¸ºæ­£æ–œæ 
                    relativePath = relativePath.replace(/\\/g, '/');
                    
                    // ç§»é™¤å¼€å¤´çš„æ–œæ 
                    if (relativePath.startsWith('/')) {
                        relativePath = relativePath.substring(1);
                    }
                    
                    // æå–æ–‡ä»¶å
                    const fileName = relativePath.split('/').pop();
                    
                    // ç¡®å®šæ–‡ä»¶ç±»å‹
                    const fileType = this.getFileTypeFromExtension(fileName);
                    
                    return {
                        name: fileName,
                        path: relativePath,
                        type: fileType
                    };
                } catch (error) {
                    console.error('è½¬æ¢è·¯å¾„å¤±è´¥:', error);
                    return null;
                }
            }

            // ä»æ–‡ä»¶æ‰©å±•åç¡®å®šæ–‡ä»¶ç±»å‹
            getFileTypeFromExtension(fileName) {
                const extension = fileName.toLowerCase().split('.').pop();
                const typeMap = {
                    'docx': 'docx',
                    'doc': 'docx',
                    'pdf': 'pdf',
                    'pptx': 'pptx',
                    'ppt': 'pptx',
                    'xlsx': 'xlsx',
                    'xls': 'xlsx',
                    'txt': 'txt',
                    'md': 'txt'
                };
                return typeMap[extension] || 'other';
            }

            // æ‰¹é‡å¯¼å…¥æ–‡ä»¶
            importFiles() {
                const bulkImportText = document.getElementById('bulkImport').value.trim();
                
                if (!bulkImportText) {
                    this.showToast('è¯·è¾“å…¥JSONæ ¼å¼çš„æ–‡ä»¶æ•°æ®', 'error');
                    return;
                }

                try {
                    const importedFiles = JSON.parse(bulkImportText);
                    
                    if (!Array.isArray(importedFiles)) {
                        throw new Error('æ•°æ®æ ¼å¼é”™è¯¯ï¼Œåº”ä¸ºæ•°ç»„');
                    }

                    // éªŒè¯æ•°æ®æ ¼å¼
                    for (const file of importedFiles) {
                        if (!file.name || !file.path || !file.type) {
                            throw new Error('æ–‡ä»¶æ•°æ®ç¼ºå°‘å¿…è¦å­—æ®µï¼ˆname, path, typeï¼‰');
                        }
                    }

                    this.files = [...this.files, ...importedFiles];
                    this.saveData();
                    this.updateAdminUI();
                    this.updateUI();
                    
                    document.getElementById('bulkImport').value = '';
                    this.showToast(`æˆåŠŸå¯¼å…¥ ${importedFiles.length} ä¸ªæ–‡ä»¶`);
                    
                } catch (error) {
                    this.showToast('JSONæ ¼å¼é”™è¯¯ï¼š' + error.message, 'error');
                }
            }

            // æ·»åŠ å•ä¸ªæ–‡ä»¶
            addSingleFile() {
                const fileName = document.getElementById('fileName').value.trim();
                const filePath = document.getElementById('filePath').value.trim();
                const fileType = document.getElementById('fileType').value;

                if (!fileName || !filePath) {
                    this.showToast('è¯·å¡«å†™æ–‡ä»¶åå’Œè·¯å¾„', 'error');
                    return;
                }

                const newFile = {
                    name: fileName,
                    path: filePath,
                    type: fileType
                };

                this.files.push(newFile);
                this.saveData();
                this.updateAdminUI();
                this.updateUI();

                // æ¸…ç©ºè¾“å…¥æ¡†
                document.getElementById('fileName').value = '';
                document.getElementById('filePath').value = '';
                document.getElementById('fileType').value = 'docx';

                this.showToast('æ–‡ä»¶å·²æ·»åŠ ');
            }

            // åˆ é™¤æ–‡ä»¶
            deleteFile(index) {
                this.files.splice(index, 1);
                this.saveData();
                this.updateAdminUI();
                this.updateUI();
                this.showToast('æ–‡ä»¶å·²åˆ é™¤');
            }

            // æ¸…ç©ºæ‰€æœ‰æ•°æ®
            clearAllData() {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                    this.files = [];
                    this.rootPath = '';
                    this.saveData();
                    this.updateAdminUI();
                    this.updateUI();
                    this.showToast('æ‰€æœ‰æ•°æ®å·²æ¸…ç©º');
                }
            }

            // æ›´æ–°ä¸»ç•Œé¢UI
            updateUI() {
                document.getElementById('fileCount').textContent = this.files.length;
            }

            // æ›´æ–°ç®¡ç†åå°UI
            updateAdminUI() {
                document.getElementById('currentNetdiskPath').textContent = this.rootPath || 'æœªè®¾ç½®';
                document.getElementById('currentLocalPrefix').textContent = this.localPathPrefix || 'æœªè®¾ç½®';
                document.getElementById('adminFileCount').textContent = this.files.length;
                document.getElementById('netdiskRootPath').value = this.rootPath;
                document.getElementById('localPathPrefix').value = this.localPathPrefix || '';
                
                // æ˜¾ç¤ºè·¯å¾„æ˜ å°„ç¤ºä¾‹
                this.updatePathMappingExample();
                
                this.updateFileList();
            }

            // æ›´æ–°è·¯å¾„æ˜ å°„ç¤ºä¾‹
            updatePathMappingExample() {
                const exampleDiv = document.getElementById('pathMappingExample');
                
                if (this.rootPath && this.localPathPrefix) {
                    const examplePath = 'BaiduNetdiskDownload\\6æœˆä»½7å·åˆ°10å·\\25.06.10æ›´æ–°\\ä½ç¢³ç‰ˆæ‘è§„æ°‘çº¦.docx';
                    const converted = this.convertWindowsPath(examplePath);
                    
                    if (converted) {
                        const fullPath = this.rootPath + converted.path;
                        exampleDiv.innerHTML = `
                            <strong>è½¬æ¢ç¤ºä¾‹ï¼š</strong><br>
                            <span class="text-gray-600 dark:text-gray-400">åŸå§‹è·¯å¾„ï¼š</span> ${examplePath}<br>
                            <span class="text-green-600 dark:text-green-400">è½¬æ¢ä¸ºï¼š</span> ${fullPath}
                        `;
                    } else {
                        exampleDiv.innerHTML = '<span class="text-red-500">è·¯å¾„æ˜ å°„é…ç½®æœ‰è¯¯</span>';
                    }
                } else {
                    exampleDiv.innerHTML = '<span class="text-gray-500">è¯·å…ˆè®¾ç½®è·¯å¾„æ˜ å°„</span>';
                }
            }

            // æ›´æ–°æ–‡ä»¶åˆ—è¡¨
            updateFileList() {
                const fileList = document.getElementById('fileList');
                
                if (this.files.length === 0) {
                    fileList.innerHTML = '<div class="p-4 text-center text-gray-500 dark:text-gray-400">æš‚æ— æ–‡ä»¶</div>';
                    return;
                }

                fileList.innerHTML = this.files.map((file, index) => `
                    <div class="flex items-center justify-between p-3 border-b border-gray-200 dark:border-gray-600 last:border-b-0">
                        <div class="flex items-center space-x-3 flex-1 min-w-0">
                            <span class="file-icon">${this.getFileIcon(file.type)}</span>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center space-x-2">
                                    <p class="font-medium text-gray-900 dark:text-white truncate">${file.name}</p>
                                    <span class="px-1 py-0.5 text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded">${file.type}</span>
                                </div>
                                <p class="text-sm text-gray-500 dark:text-gray-400 truncate">${file.path}</p>
                            </div>
                        </div>
                        <button 
                            onclick="app.deleteFile(${index})" 
                            class="text-red-600 hover:text-red-800 text-sm font-medium ml-3"
                        >
                            åˆ é™¤
                        </button>
                    </div>
                `).join('');
            }

            // æ˜¾ç¤ºToasté€šçŸ¥
            showToast(message, type = 'success') {
                const toast = document.getElementById('toast');
                const toastMessage = document.getElementById('toastMessage');
                
                toastMessage.textContent = message;
                toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 ${
                    type === 'error' ? 'bg-red-600' : 'bg-green-600'
                } text-white`;
                
                toast.classList.remove('hidden');
                
                setTimeout(() => {
                    toast.classList.add('hidden');
                }, 3000);
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        const app = new FileSearchApp();
    </script>


</body></html>